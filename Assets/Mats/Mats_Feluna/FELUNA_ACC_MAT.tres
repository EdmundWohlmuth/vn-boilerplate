[gd_resource type="ShaderMaterial" load_steps=10 format=3 uid="uid://dxgmm8y7qxk63"]

[ext_resource type="Texture2D" uid="uid://dahal7iyfsymw" path="res://Assets/Textures/Tex_Feluna/Accessories_TEXT.png" id="1_4x4nd"]

[sub_resource type="Shader" id="Shader_5o7aj"]
code = "shader_type spatial;
render_mode blend_mix,depth_draw_opaque,cull_disabled,diffuse_toon,specular_toon;

uniform vec4 albedo : source_color;
uniform sampler2D color_gradient;
uniform sampler2D depth_gradient;
uniform sampler2D fresnel_gradient;
uniform sampler2D diffuse_texture : source_color;
uniform sampler2D dither_texture : source_color;

float fresnel(float amount, vec3 normal, vec3 view)
{
    return pow((1.0 - clamp(dot(normalize(normal), normalize(view)), 0.0, 1.0)), amount);
}

void vertex(){

}

void fragment(){
    vec3 diffusetex_color = texture(diffuse_texture, UV).rgb;
    float depth = clamp(-VERTEX.z / 10.0, 0.0, 1.0);
    float basic_fresnel = fresnel(4, NORMAL, VIEW);
    //ALBEDO = vec3(depth);//(diffusetex_color); //+ (basic_fresnel + texture(fresnel_gradient, vec2(basic_fresnel, 0.0)).rgb + 1.0);
    vec3 dither_mask = texture(dither_texture, SCREEN_UV * VIEWPORT_SIZE / 5.0).rgb;
    vec3 depth_layer = (texture(depth_gradient, vec2(depth, 0.0)).rgb);
    vec3 dither_plus_diffuse = depth_layer * diffusetex_color * mix(depth_layer,diffusetex_color, 1.0 - dither_mask * 0.3);//diffusetex_color * dither_mask + depth_layer * (1.0 - dither_mask);
    vec3 fresnel_layer = texture(fresnel_gradient, vec2(basic_fresnel, 0.0)).rgb;

    ALBEDO = 1.0 - (1.0 - dither_plus_diffuse) * (1.0 - fresnel_layer);
}

void light() {
    float dotproduct = clamp(dot(NORMAL, LIGHT), -0.9, 0.9);
    float sample = clamp((dotproduct + 1.0) + ATTENUATION / 2.1, 0.05, 0.95);
    vec4 shaded = texture(color_gradient, vec2(sample, 0.0));

    vec3 dither_mask = texture(dither_texture, SCREEN_UV * VIEWPORT_SIZE / 5.0).rgb;
    vec3 lighting = clamp((shaded.rgb * LIGHT_COLOR * sample), 0.0, 1.0);
    DIFFUSE_LIGHT += clamp((shaded.rgb * LIGHT_COLOR * sample), 0.0, 1.0);
    //DIFFUSE_LIGHT += mix(DIFFUSE_LIGHT, dither_mask, lighting);

}"

[sub_resource type="Gradient" id="Gradient_4x4nd"]
interpolation_mode = 1
offsets = PackedFloat32Array(0.783333, 0.875)
colors = PackedColorArray(0.168075, 0.127698, 0.176942, 1, 0.329701, 0.291891, 0.304937, 1)

[sub_resource type="GradientTexture1D" id="GradientTexture1D_jiawb"]
gradient = SubResource("Gradient_4x4nd")

[sub_resource type="Gradient" id="Gradient_d5i0y"]
offsets = PackedFloat32Array(0.620833, 0.645833)
colors = PackedColorArray(1, 1, 1, 1, 0.584276, 0.536296, 0.687088, 1)

[sub_resource type="GradientTexture1D" id="GradientTexture1D_7l7ga"]
gradient = SubResource("Gradient_d5i0y")

[sub_resource type="CompressedTexture2D" id="CompressedTexture2D_yem0w"]
load_path = "res://.godot/imported/DITHER_TEX.png-6586e24665ba4e952f2c26f9eb2bc4ef.s3tc.ctex"

[sub_resource type="Gradient" id="Gradient_y7vjw"]
offsets = PackedFloat32Array(0, 0.3375)
colors = PackedColorArray(0.190762, 0.190762, 0.190762, 1, 0, 0, 0, 1)

[sub_resource type="GradientTexture1D" id="GradientTexture1D_du65n"]
gradient = SubResource("Gradient_y7vjw")

[resource]
render_priority = 0
shader = SubResource("Shader_5o7aj")
shader_parameter/albedo = Color(1, 1, 1, 1)
shader_parameter/color_gradient = SubResource("GradientTexture1D_jiawb")
shader_parameter/depth_gradient = SubResource("GradientTexture1D_7l7ga")
shader_parameter/fresnel_gradient = SubResource("GradientTexture1D_du65n")
shader_parameter/diffuse_texture = ExtResource("1_4x4nd")
shader_parameter/dither_texture = SubResource("CompressedTexture2D_yem0w")
